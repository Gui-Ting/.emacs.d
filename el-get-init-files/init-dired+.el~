(require 'dired)
(require 'dired-x)                   ;這行請記得加，不然無法使用隱藏檔案等功能。
(require 'dired+)                    ;請記得安裝 dired+，沒安裝的是笨蛋

;; 讓 Dired 有「多欄式」效果：用 C-x 3 在螢幕上開兩個 dired 視窗（如
;; 附圖），再來只要按 R 或 C（移動/複製檔案）時，會自動以另一個視窗為
;; 預設目標路徑。
(setq dired-dwim-target t)


;; 目錄排在檔案之前。
(defun dired-directory-sort ()
    "Dired sort hook to list directories first."
      (save-excursion
            (let (buffer-read-only)
                    (forward-line 2) ;; beyond dir. header
                          (sort-regexp-fields t "^.*$" "[ ]*." (point) (point-max))))
        (and (featurep 'xemacs)
                    (fboundp 'dired-insert-set-properties)
                           (dired-insert-set-properties (point-min) (point-max)))
          (set-buffer-modified-p nil))

(add-hook 'dired-after-readin-hook 'dired-directory-sort)

;; 按 q 回到上層目錄，並自動把 cursor 移動到前一個目錄處
(defun my-dired-backward ()
    "Go back to the parent directory (..), and the cursor will be moved to where
          the previous directory."
      (interactive)
        (let* ((DIR (buffer-name)))
              (if (equal DIR "*Find*")
                          (quit-window t)
                      (progn (find-alternate-file "..")
                                          (re-search-forward DIR nil :no-error)
                                                       (revert-buffer)))))
(define-key dired-mode-map (kbd "q") 'my-dired-backward)  
